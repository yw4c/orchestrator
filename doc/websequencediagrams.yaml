# 循序圖生成網站
# https://www.websequencediagrams.com/#
# 記錄生成文件，方便閱讀使用 yaml 開啟

title SagaAsync
Client->Endpoint: 訂單資料 (http)
Endpoint->Orchestrator: 訂單資料 (gRPC)
Orchestrator->MQ: 訂單資料 (publish)
Orchestrator->Endpoint: OK (gRPC)
Endpoint->Client: OK (http)
MQ->Orchestrator: 訂單資料 (consume)
Orchestrator->Order: 訂單資料 (gRPC)
Order->Order: 建立訂單
Order->Client: Callback (http)
Order->Orchestrator: OK (gRPC)
---
title SagaSync
Client->Endpoint: 訂單資料 (http)
Endpoint->Orchestrator: 訂單資料 (gRPC)
Orchestrator->Order: 訂單資料 (gRPC)
Order->Order: 建立訂單
Order->Orchestrator: 訂單編號 (gRPC)
Orchestrator->Payment: 訂單編號 (gRPC)
Payment->Payment: 建立付款單
Payment->Orchestrator: 付款資訊 (gRPC)
Orchestrator->Endpoint: 付款資訊 (gRPC)
Endpoint->Client: 付款資訊 (http)
---
title SagaHybrid
Client->Endpoint: 訂單資料 (http)
Endpoint->Orchestrator: 訂單資料 (gRPC)
Orchestrator->Redis: 監聽流程是否完成
Orchestrator->MQ: 訂單資料 (publish)
MQ->Orchestrator: 訂單資料 (consume)
Orchestrator->Order: 訂單資料 (gRPC)
Order->Order: 建立訂單
Order->Orchestrator: OK (gRPC)
Orchestrator->Redis: 修改流程為已完成
Redis->Orchestrator: 觸發
Orchestrator->Endpoint: OK (gRPC)
Endpoint->Client: OK (http)
---
title Rollback
Client->Endpoint: 訂單資料 (http)
Endpoint->Orchestrator: 訂單資料 (gRPC)
Orchestrator->Order: 訂單資料 (gRPC)
Order->Order: 建立訂單
Order->Orchestrator: 訂單編號 (gRPC)
Orchestrator->Payment: 訂單編號 (gRPC)
Payment->Payment: 建立收款單失敗
Payment->Orchestrator: error (gRPC)
Orchestrator->MQ: traceID (publish)
MQ->Orchestrator: traceID (consume)
Orchestrator->Order: traceID (gRPC)
Order->Order: 取消訂單
Order->Orchestrator: OK (gRPC)
Orchestrator->Endpoint: error (gRPC)
Endpoint->Client: error (http)


